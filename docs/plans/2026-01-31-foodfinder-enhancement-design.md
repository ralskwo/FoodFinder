# FoodFinder 고도화 설계 문서

**작성일:** 2026-01-31
**상태:** 확정

---

## 1. 개요

FoodFinder 프로젝트를 고도화하여 사용자가 설정한 위치, 반경, 예산, 카테고리를 기반으로 주변 음식점을 검색하고, 예산 내 메뉴를 가진 음식점을 필터링할 수 있도록 한다.

### 핵심 요구사항

1. 위치 설정: GPS 감지 / 지도 드래그 / 주소 검색
2. 반경 검색: 최대 5km까지 설정 가능
3. 메뉴 가격 정보: 크롤링을 통한 실제 메뉴/가격 데이터 수집
4. 예산 필터링: 설정 예산 내 메뉴를 가진 음식점 필터링
5. 카테고리 필터링: 한식, 중식, 일식 등 분류

---

## 2. 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        Frontend (React)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 지도 컴포넌트 │  │ 리스트 패널  │  │ 필터/검색 컴포넌트   │  │
│  │ (Naver Maps)│  │             │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     Backend (Flask API)                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐   │
│  │ 검색 API     │  │ 크롤링 서비스 │  │ 캐시 관리        │   │
│  └──────────────┘  └──────────────┘  └──────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
   │ 네이버 API   │    │ 외부 크롤링  │    │   SQLite    │
   │ (검색/지도)  │    │ (플레이스,   │    │ (캐시 DB)   │
   │             │    │  배달앱)     │    │             │
   └─────────────┘    └─────────────┘    └─────────────┘
```

### 데이터 흐름

1. 사용자가 위치/반경/예산/카테고리 설정
2. Backend에서 먼저 캐시 DB 조회
3. 캐시 없으면 네이버 검색 API로 음식점 목록 획득
4. 각 음식점의 메뉴/가격 정보를 크롤링 (네이버 플레이스 → 배달앱 → 카카오 순)
5. 결과를 캐시에 저장 후 응답
6. Frontend에서 예산 필터링 적용 후 표시

---

## 3. 위치 설정

### 3가지 방식

1. **현재 위치 감지**
   - 브라우저 Geolocation API 사용
   - "내 위치" 버튼 클릭 시 GPS 좌표 획득
   - 권한 거부 시 기본 위치(서울 시청) 또는 주소 입력 유도

2. **지도에서 직접 선택**
   - 네이버 지도에서 드래그하여 원하는 위치로 이동
   - 지도 중앙에 핀 마커 고정 표시
   - "이 위치로 검색" 버튼으로 확정
   - 지도 이동 시 실시간으로 주소 표시 (reverse geocoding)

3. **주소 검색**
   - 텍스트 입력창에 주소/건물명 입력
   - 네이버 geocoding API로 좌표 변환
   - 자동완성 제안 목록 표시

---

## 4. 메뉴/가격 크롤링 시스템

### 크롤링 우선순위

```
1순위: 네이버 플레이스
   └─ URL: https://pcmap.place.naver.com/restaurant/{place_id}/menu
   └─ 수집: 메뉴명, 가격, 대표메뉴 여부

2순위: 배달앱 (배달의민족/요기요)
   └─ 음식점명 + 주소로 매칭
   └─ 수집: 메뉴명, 가격, 인기메뉴

3순위: 카카오맵 API
   └─ 카카오 로컬 API의 메뉴 정보 (제한적)
```

### 하이브리드 캐싱 전략

```python
def get_menu_info(restaurant):
    # 1. 캐시 확인 (24시간 이내 데이터)
    cached = db.get_cached_menu(restaurant.place_id, max_age=24h)
    if cached:
        return cached

    # 2. 캐시 없으면 실시간 크롤링
    menu = crawl_naver_place(restaurant.place_id)
    if not menu:
        menu = crawl_delivery_apps(restaurant.name, restaurant.address)
    if not menu:
        menu = fetch_kakao_menu(restaurant.name)

    # 3. 결과 캐싱
    db.save_menu_cache(restaurant.place_id, menu)
    return menu
```

### 크롤링 안정성

- 요청 간 딜레이 (0.5초)로 차단 방지
- User-Agent 헤더 설정
- 실패 시 다음 소스로 폴백

---

## 5. 필터링 시스템

### 필터 UI 구성

```
┌─────────────────────────────────────────────────────────┐
│ 🔍 검색어 입력 [                          ] [검색]      │
├─────────────────────────────────────────────────────────┤
│ 📍 반경: [━━━━━●━━━━━] 2.0km                           │
│         100m ─────────────────────── 5km               │
├─────────────────────────────────────────────────────────┤
│ 💰 예산:                                                │
│   [5천원] [1만원] [1.5만원] [2만원] [3만원] [직접입력]   │
│   [━━━━━━━━●━━━] 12,000원                              │
│   ○ 메뉴 기준  ● 평균 기준                              │
├─────────────────────────────────────────────────────────┤
│ 🍽️ 카테고리:                                            │
│   [전체] [한식] [중식] [일식] [양식] [분식]             │
│   [카페] [패스트푸드] [치킨] [피자] [아시안] [더보기▼]   │
└─────────────────────────────────────────────────────────┘
```

### 필터링 로직

1. **거리 필터** (Backend)
   - 하버사인 공식으로 정확한 거리 계산
   - 설정 반경 초과 음식점 제외

2. **예산 필터** (Backend)
   - 메뉴 기준: 해당 가격 이하 메뉴가 1개 이상 있는 음식점
   - 평균 기준: 전체 메뉴 평균 가격이 설정값 이하인 음식점

3. **카테고리 필터** (Backend)
   - 네이버 카테고리 기준 매핑
   - 복수 선택 가능 (OR 조건)

### 카테고리 목록 (네이버 기준)

한식, 중식, 일식, 양식, 분식, 카페/디저트, 패스트푸드, 치킨, 피자, 아시안/베트남/태국, 멕시칸, 샐러드/건강식, 술집/호프, 베이커리

---

## 6. UI 레이아웃

### 데스크톱 (분할 화면)

```
┌──────────────────────────────────────────────────────────────────┐
│  [🔍 검색] [📍 내 위치] [필터 ▼]                    FoodFinder   │
├────────────────────────────┬─────────────────────────────────────┤
│                            │                                     │
│  ┌──────────────────────┐  │                                     │
│  │ 🍜 맛있는 칼국수      │  │                                     │
│  │ 한식 · 350m · ⭐ 4.2  │  │           네이버 지도               │
│  │ 칼국수 8,000원        │  │                                     │
│  │ [상세보기]            │  │            📍 (핀 마커들)           │
│  └──────────────────────┘  │                                     │
│  ┌──────────────────────┐  │                                     │
│  │ 🍕 피자헛 OO점        │  │                                     │
│  │ 피자 · 1.2km · ⭐ 3.8 │  │                                     │
│  │ 치즈피자 15,000원     │  │                                     │
│  │ [상세보기]            │  │                                     │
│  └──────────────────────┘  │                                     │
│           ...              │                                     │
├────────────────────────────┴─────────────────────────────────────┤
│  검색 결과 24개 · 예산 12,000원 이하                             │
└──────────────────────────────────────────────────────────────────┘
```

### 모바일 (하단 시트)

```
┌─────────────────────┐
│                     │
│     네이버 지도      │
│      📍 📍 📍       │
│                     │
├─────────────────────┤ ← 드래그하여 높이 조절
│ ≡ 검색 결과 24개    │
├─────────────────────┤
│ 맛있는 칼국수       │
│ 한식·350m·⭐4.2    │
│ 칼국수 8,000원      │
├─────────────────────┤
│ 피자헛 OO점         │
│ ...                 │
└─────────────────────┘
```

### 상세보기 패널 (사이드 확장)

```
┌─────────────────────────────────────┬───────────────────────────┐
│  [← 뒤로]  맛있는 칼국수            │                           │
├─────────────────────────────────────┤                           │
│  한식 · 350m · ⭐ 4.2 (리뷰 128)    │                           │
│  📍 서울시 강남구 역삼동 123-45     │       네이버 지도          │
│  📞 02-1234-5678                    │                           │
│  🕐 11:00 - 21:00                   │          📍               │
├─────────────────────────────────────┤                           │
│  메뉴                               │                           │
│  ┌────────────────────────────────┐ │                           │
│  │ 칼국수         8,000원         │ │                           │
│  │ 비빔국수       8,000원         │ │                           │
│  │ 수육          25,000원         │ │                           │
│  │ 만두           5,000원         │ │                           │
│  └────────────────────────────────┘ │                           │
└─────────────────────────────────────┴───────────────────────────┘
```

### 음식점 카드 정보

- 이름
- 카테고리
- 거리
- 평점
- 대표 메뉴 1-2개 (가격 포함)
- [상세보기] 버튼

---

## 7. 데이터베이스 스키마

```sql
-- 음식점 기본 정보 캐시
CREATE TABLE restaurants (
    id INTEGER PRIMARY KEY,
    place_id VARCHAR(50) UNIQUE NOT NULL,  -- 네이버 place_id
    name VARCHAR(100) NOT NULL,
    category VARCHAR(50),
    address VARCHAR(200),
    road_address VARCHAR(200),
    latitude DECIMAL(10, 7),
    longitude DECIMAL(10, 7),
    phone VARCHAR(20),
    rating DECIMAL(2, 1),
    review_count INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 메뉴 정보 캐시
CREATE TABLE menus (
    id INTEGER PRIMARY KEY,
    restaurant_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    price INTEGER,                          -- 원 단위
    is_representative BOOLEAN DEFAULT FALSE, -- 대표메뉴 여부
    source VARCHAR(20),                     -- 'naver', 'baemin', 'yogiyo', 'kakao', 'user'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (restaurant_id) REFERENCES restaurants(id)
);

-- 사용자 입력 메뉴 (향후 확장용)
CREATE TABLE user_menu_contributions (
    id INTEGER PRIMARY KEY,
    restaurant_id INTEGER NOT NULL,
    menu_name VARCHAR(100) NOT NULL,
    price INTEGER,
    contributed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (restaurant_id) REFERENCES restaurants(id)
);
```

### 캐시 정책

- 음식점 기본 정보: 7일 유효
- 메뉴 정보: 24시간 유효
- 사용자 입력: 영구 저장

---

## 8. API 엔드포인트

### 위치 관련

```
GET  /api/geocode/reverse?lat={lat}&lng={lng}
     → 좌표를 주소로 변환

GET  /api/geocode?query={address}
     → 주소를 좌표로 변환
```

### 음식점 검색

```
POST /api/restaurants/search
     Body: {
       "lat": 37.5665,
       "lng": 126.9780,
       "radius": 2000,           // 미터 단위
       "budget": 12000,          // 원 단위 (optional)
       "budget_type": "menu",    // "menu" 또는 "average"
       "categories": ["한식", "중식"],  // (optional)
       "query": "칼국수"         // (optional)
     }
     → 필터링된 음식점 목록 + 대표 메뉴 1-2개
```

### 음식점 상세

```
GET  /api/restaurants/{place_id}
     → 음식점 상세 정보

GET  /api/restaurants/{place_id}/menus
     → 전체 메뉴 목록 (캐시 없으면 크롤링)
```

### 사용자 메뉴 입력

```
POST /api/restaurants/{place_id}/menus/contribute
     Body: {
       "menu_name": "김치찌개",
       "price": 8000
     }
     → 사용자 메뉴 정보 저장
```

### 응답 예시 (검색 결과)

```json
{
  "results": [
    {
      "place_id": "1234567890",
      "name": "맛있는 칼국수",
      "category": "한식",
      "distance": 350,
      "rating": 4.2,
      "address": "서울시 강남구 역삼동 123-45",
      "lat": 37.5012,
      "lng": 127.0396,
      "representative_menus": [
        {"name": "칼국수", "price": 8000},
        {"name": "비빔국수", "price": 8000}
      ]
    }
  ],
  "total": 24,
  "filters_applied": {
    "radius": 2000,
    "budget": 12000,
    "budget_type": "menu"
  }
}
```

---

## 9. 향후 확장 (나중에 추가)

- 사용자 인증 시스템
- 즐겨찾기 기능
- 유저별 맞춤 데이터베이스
- 리뷰/평점 시스템

---

## 10. 기술 스택 요약

| 영역 | 기술 |
|------|------|
| Frontend | React 18, Naver Maps JavaScript API v3 |
| Backend | Flask 3.0, SQLAlchemy 2.0 |
| Database | SQLite (캐시 + 사용자 데이터) |
| 크롤링 | requests, BeautifulSoup |
| 외부 API | Naver Search API, Naver Maps API, Kakao Local API |
